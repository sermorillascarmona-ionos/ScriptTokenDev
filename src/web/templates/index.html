<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîê Token Helper</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    header h1 { font-size: 2.5em; margin-bottom: 10px; }
    header p { opacity: 0.9; font-size: 1.1em; }
    .content { padding: 30px; }
    .alert {
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.95em;
    }
    .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .alert-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    .section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      border: 1px solid #e9ecef;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .section:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .section h2 {
      color: #495057;
      margin-bottom: 20px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    label {
      font-weight: 600;
      color: #495057;
      display: block;
      margin: 15px 0 8px;
      font-size: 0.95em;
    }
    input[type="text"], textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
    }
    input[type="text"]:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
    }
    textarea {
      height: 320px;
      resize: vertical;
      font-size: 0.85em;
    }
    @keyframes tokenUpdated {
      0% {
        background-color: #d4edda;
        border-color: #28a745;
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
        transform: scale(1);
      }
      25% {
        box-shadow: 0 0 20px 10px rgba(40, 167, 69, 0.4);
        transform: scale(1.02);
      }
      50% {
        background-color: #c3e6cb;
        box-shadow: 0 0 30px 15px rgba(40, 167, 69, 0.2);
      }
      75% {
        box-shadow: 0 0 20px 10px rgba(40, 167, 69, 0.1);
        transform: scale(1.01);
      }
      100% {
        background-color: white;
        border-color: #28a745;
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
        transform: scale(1);
      }
    }
    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 0 5px rgba(40, 167, 69, 0.5); }
      50% { box-shadow: 0 0 20px rgba(40, 167, 69, 0.8); }
    }
    .token-updated {
      animation: tokenUpdated 2s ease-out forwards;
    }
    .token-updated-glow {
      border-color: #28a745 !important;
      animation: pulseGlow 1s ease-in-out 3;
    }
    .update-badge {
      display: none;
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
      margin-bottom: 10px;
      animation: slideIn 0.5s ease-out;
    }
    .update-badge.show {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background: #28a745;
      animation: confettiFall 3s ease-out forwards;
      pointer-events: none;
      z-index: 1000;
    }
    @keyframes confettiFall {
      0% {
        opacity: 1;
        transform: translateY(0) rotate(0deg);
      }
      100% {
        opacity: 0;
        transform: translateY(100vh) rotate(720deg);
      }
    }
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 15px;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    button:active { transform: translateY(0); }
    code {
      background: #f1f3f5;
      padding: 3px 8px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      color: #e83e8c;
    }
    .file-list {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      border: 1px solid #dee2e6;
    }
    .file-list ul { list-style: none; }
    .file-list li {
      padding: 8px 0;
      border-bottom: 1px solid #f1f3f5;
      font-size: 0.9em;
      color: #6c757d;
    }
    .file-list li:last-child { border-bottom: none; }
    pre {
      background: #2d3748;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.85em;
      line-height: 1.6;
      margin-top: 15px;
    }
    .vpn-warning {
      background: #fff3cd;
      border: 2px solid #ffc107;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .vpn-warning::before {
      content: "‚ö†Ô∏è";
      font-size: 1.5em;
    }
    footer {
      text-align: center;
      padding: 20px;
      color: #6c757d;
      font-size: 0.9em;
      border-top: 1px solid #e9ecef;
    }
    @media (max-width: 768px) {
      .container { border-radius: 0; }
      .content { padding: 20px; }
      header { padding: 20px; }
      header h1 { font-size: 1.8em; }
    }
    .docs-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      border: 1px solid #e9ecef;
    }
    .docs-section h2 {
      color: #495057;
      margin-bottom: 20px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }
    .docs-content {
      display: none;
      padding-top: 15px;
    }
    .docs-content.show {
      display: block;
    }
    .docs-content h3 {
      color: #495057;
      margin: 20px 0 10px;
      font-size: 1.2em;
    }
    .docs-content h4 {
      color: #6c757d;
      margin: 15px 0 8px;
      font-size: 1em;
    }
    .docs-content p {
      color: #6c757d;
      margin: 8px 0;
      line-height: 1.6;
    }
    .docs-content ul {
      margin: 10px 0 10px 20px;
      color: #6c757d;
    }
    .docs-content li {
      margin: 5px 0;
      line-height: 1.5;
    }
    .docs-content pre {
      margin: 10px 0;
    }
    .docs-content hr {
      border: none;
      border-top: 1px solid #dee2e6;
      margin: 20px 0;
    }
    .toggle-icon {
      transition: transform 0.3s;
    }
    .toggle-icon.open {
      transform: rotate(180deg);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üîê Token Helper</h1>
      <p>Gestor de Tokens JWT para Desarrollo</p>
    </header>

    <div class="content">
      <div class="docs-section">
        <h2 onclick="toggleDocs()" style="cursor: pointer;">
          üìö 0. Requisitos e Instalaci√≥n
          <span class="toggle-icon" id="toggle-icon">‚ñº</span>
        </h2>
        <div class="docs-content" id="docs-content">
          <h3>Requisitos previos</h3>
          <ul>
            <li>Python 3.8 o superior</li>
            <li>Acceso a la VPN corporativa (para conexi√≥n a SQL Server)</li>
            <li>Acceso a los archivos de configuraci√≥n y credenciales</li>
          </ul>

          <h3>Instalaci√≥n de dependencias (Ubuntu y Linux Mint)</h3>

          <h4>1. Instalar Python y pip</h4>
          <p>Ubuntu y Mint ya incluyen Python 3, pero aseg√∫rate de tenerlo actualizado:</p>
          <pre>sudo apt update
sudo apt install python3 python3-pip</pre>

          <h4>2. Instalar dependencias Python</h4>
          <pre>pip3 install jaydebeapi python-dotenv</pre>

          <h4>3. Descargar el driver jTDS</h4>
          <p>Descarga el archivo <code>jtds-1.3.1.jar</code> desde:</p>
          <p><a href="https://sourceforge.net/projects/jtds/files/jtds/1.3.1/" target="_blank" style="color: #667eea;">https://sourceforge.net/projects/jtds/files/jtds/1.3.1/</a></p>
          <p>Col√≥calo en la misma carpeta que <code>token_helper.py</code>.</p>

          <h4>4. Configurar el archivo .env</h4>
          <p>Copia el ejemplo y ed√≠talo con tus credenciales:</p>
          <pre>cp .env.example .env
nano .env</pre>
          <p>Variables principales:</p>
          <ul>
            <li><code>DB_HOST</code>, <code>DB_PORT</code>, <code>DB_NAME</code>, <code>DB_DOMAIN</code>, <code>DB_USER</code>, <code>DB_PASSWORD</code></li>
            <li><code>JSON_PATH</code>, <code>JS_PATH</code>, <code>PORT</code>, <code>LOGIN_URL</code></li>
          </ul>

          <h4>5. Ejecutar el script</h4>
          <pre>python3 token_helper.py</pre>
          <p>Accede a la interfaz web en: <code>http://localhost:8000</code> (o el puerto configurado)</p>

          <hr>

          <h3>Notas adicionales</h3>
          <ul>
            <li><strong>VPN:</strong> Debes estar conectado a la VPN para acceder a la base de datos SQL Server.</li>
            <li><strong>Permisos:</strong> Aseg√∫rate de tener permisos de lectura/escritura en los archivos de configuraci√≥n.</li>
            <li><strong>Soporte:</strong> Si falta alguna dependencia, inst√°lala con <code>pip3 install &lt;paquete&gt;</code>.</li>
          </ul>

          <hr>

          <h3>Ejemplo de archivo .env</h3>
          <pre>DB_HOST=dev-ngcs-sqldb.dev-ngcs.lan
DB_PORT=1433
DB_NAME=ngcs
DB_DOMAIN=ARSYSLAN
DB_USER=usuario
DB_PASSWORD=tu_password
JSON_PATH=/ruta/al/http-client.private.env.json
JS_PATH=/ruta/al/config.js
PORT=8000
LOGIN_URL=https://com-cloudpanel-ionos-dev.com.schlund.de:36888/loginany
TDS_VERSION=8.0</pre>

          <hr>
          <p style="text-align: center; margin-top: 20px;"><strong>Desarrollado por el equipo ArsysLab</strong></p>
        </div>
      </div>

      {{ msg_block }}

      <div class="section">
        <h2>üåê 1. Login Demo (Panel)</h2>
        <form method="POST">
          <input type="hidden" name="action" value="login_demo" />
          <label for="prov_login">Provisioning ID:</label>
          <input type="text" id="prov_login" name="provisioningId" placeholder="36" required />

          <label for="section">Section (landing):</label>
          <input type="text" id="section" name="section" placeholder="none, servers, images..." value="none" />

          <label for="locale">Locale:</label>
          <input type="text" id="locale" name="locale" placeholder="af_AF, es_ES, en_US..." value="af_AF" />

          <button type="submit">üöÄ Probar Login</button>
        </form>

        {{ login_result_block }}
      </div>

      <div class="section">
        <h2>üóÑÔ∏è 2. Obtener desde SQL Server</h2>

        <div class="vpn-warning">
          <div>
            <strong>VPN Requerida:</strong> Debes estar conectado a la VPN para acceder a
            <code>dev-ngcs-sqldb.dev-ngcs.lan</code>
          </div>
        </div>

        <form method="POST">
          <input type="hidden" name="action" value="db_token" />
          <label for="prov2">Provisioning ID (CPPR_PROVISIONINGID):</label>
          <input type="text" id="prov2" name="provisioningId" placeholder="36" required />
          <button type="submit">üîç Buscar Token en DB</button>
        </form>

        {{ db_result_block }}
      </div>

      <div class="section" id="token-section">
        <h2>üìù 3. Actualizar Token Manualmente</h2>
        <div class="update-badge" id="update-badge">
          ‚ú® ¬°Token actualizado desde la base de datos!
        </div>
        <form method="POST">
          <input type="hidden" name="action" value="update_files" />
          <label for="token">Token JWT (incluye <code>Bearer ...</code>):</label>
          <textarea id="token" name="token" placeholder="Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." class="{{ token_animation_class }}">{{ current_token }}</textarea>
          <button type="submit">üíæ Guardar Token</button>
        </form>

        <div class="file-list">
          <strong>üìÅ Archivos que se actualizar√°n:</strong>
          <ul>
            <li>üìÑ {{ json_path }}</li>
            <li>üìÑ {{ js_path }}</li>
          </ul>
        </div>
      </div>

      <footer>
        <p>üí° <strong>Tip:</strong> Configura tus credenciales en <code>.env</code> para uso personal</p>
        <p style="margin-top: 8px;">Token Helper v2.0 | Desarrollado con ‚ù§Ô∏è por el equipo ArsysLab</p>
      </footer>
    </div>
  </div>

  <script>
    function toggleDocs() {
      const content = document.getElementById('docs-content');
      const icon = document.getElementById('toggle-icon');
      content.classList.toggle('show');
      icon.classList.toggle('open');
    }

    document.addEventListener('DOMContentLoaded', function() {
      const tokenTextarea = document.getElementById('token');
      const updateBadge = document.getElementById('update-badge');
      const tokenSection = document.getElementById('token-section');

      if (tokenTextarea && tokenTextarea.classList.contains('token-updated')) {
        if (updateBadge) {
          updateBadge.classList.add('show');
          setTimeout(() => {
            updateBadge.style.animation = 'slideIn 0.5s ease-out reverse';
            setTimeout(() => updateBadge.classList.remove('show'), 500);
          }, 5000);
        }

        setTimeout(() => {
          tokenSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 300);

        createConfetti();

        setTimeout(() => {
          tokenTextarea.classList.remove('token-updated');
          tokenTextarea.classList.add('token-updated-glow');
        }, 2000);

        setTimeout(() => {
          tokenTextarea.classList.remove('token-updated-glow');
        }, 5000);
      }
    });

    function createConfetti() {
      const colors = ['#28a745', '#20c997', '#667eea', '#764ba2', '#ffc107'];
      const tokenSection = document.getElementById('token-section');
      const rect = tokenSection.getBoundingClientRect();

      for (let i = 0; i < 30; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = (rect.left + Math.random() * rect.width) + 'px';
          confetti.style.top = (rect.top + window.scrollY) + 'px';
          confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
          confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
          document.body.appendChild(confetti);
          setTimeout(() => confetti.remove(), 3000);
        }, i * 50);
      }
    }
  </script>
</body>
</html>

